generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Persona {
  id_persona   Int         @id @default(autoincrement())
  nombre       String
  apellido     String?
  cedula       String?     @unique
  correo       String?
  tipo_persona TipoPersona
  estado       Boolean     @default(true)
  codigoqr     CodigoQR[]

  @@map("persona")
}

model CodigoQR {
  id_codigo   Int       @id @default(autoincrement())
  codigo      String    @unique
  tipo_qr     TipoQR
  max_usos    Int       @default(1)
  usos_actual Int       @default(0)
  personaId   Int?
  persona     Persona?  @relation(fields: [personaId], references: [id_persona])
  ingresos    Ingreso[]

  @@index([personaId], map: "codigoqr_personaId_fkey")
  @@map("codigoqr")
}

model Ingreso {
  id_ingreso Int      @id @default(autoincrement())
  fecha      DateTime @default(now())
  codigoqrId Int
  codigoqr   CodigoQR @relation(fields: [codigoqrId], references: [id_codigo])

  @@index([codigoqrId], map: "ingreso_codigoqrId_fkey")
  @@map("ingreso")
}

model Importacion {
  id              Int      @id @default(autoincrement())
  archivo         String
  usuario         String?
  fecha           DateTime @default(now())
  total_registros Int      @default(0)
  exitosos        Int      @default(0)
  fallidos        Int      @default(0)
  errores         Json?

  @@map("importacion")
}

enum TipoPersona {
  estudiante
  familiar
  visitante
}

enum TipoQR {
  est
  fam
  vis
}
